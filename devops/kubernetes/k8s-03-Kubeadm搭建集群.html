<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><title>k8s 集群搭建 | VuePress ！</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="preload" href="/vuepress-starter/assets/style-9631a17f.css" as="style"><link rel="stylesheet" href="/vuepress-starter/assets/style-9631a17f.css">
    <link rel="modulepreload" href="/vuepress-starter/assets/app-999de8cb.js"><link rel="modulepreload" href="/vuepress-starter/assets/k8s-03-Kubeadm搭建集群.html-725522cd.js"><link rel="modulepreload" href="/vuepress-starter/assets/k8s-03-Kubeadm搭建集群.html-a0f434da.js"><link rel="prefetch" href="/vuepress-starter/assets/index.html-3e48afd3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker-compose命令大全.html-93eb499d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker常用命令大全.html-f3e287e3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker镜像构建.html-7d7e4c30.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-01-Kubernetes系统原理.html-9dccf374.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-04-Kubectl核心使用.html-b7221f79.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-05-Dashboard安装和使用.html-b4ef007e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-06-Pod原理和详解.html-af85acb7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-07-工作负载详情.html-efda3e84.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-08-服务介绍.html-ccd6b91c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-09-Ingress.html-390ccaf5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-10-Storage.html-6e04cf17.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-11-集群配置默认存储类.html-b26ea5f4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-12-Configmap和Secret.html-90e577e4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-13-HorizontalPodAutoscaler.html-8899a225.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-14-创建并部署WordPress.html-104e8204.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-15-部署中间件.html-47c1520e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-16-Devops.html-2248dbdf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-17-Istio基本介绍.html-adf5b5c0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/字典树.html-e2c6ee6a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/常用10种算法.html-5b8b9a70.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/排序算法.html-701197dc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/AQS工具类.html-bca75b08.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Atomic和Unsafe.html-1c37fa28.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/CPU缓存一致性协议MESI.html-f077c1c5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Collections.html-b8e8c729.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Executor线程池.html-ce612aa5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Future_ForkJoin.html-fa843369.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java内存模型.html-1c30a945.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Synchronized.html-ac25c50f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象队列同步器AQS.html-9d1d4326.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/操作系统底层的整体认识.html-9ac36108.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java设计模式.html-7f13f31c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM内存模型.html-77ac90db.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM对象创建和内存分配.html-4da68e3a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM类加载机制.html-d5eacc9b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器G1和ZGC.html-6331579d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器ParNew和CMS.html-270444fe.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/中介者模式.html-adab21e6.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/命令模式.html-1320181f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/备忘录模式.html-02606526.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/模板模式.html-3e94ee87.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/状态模式.html-a7df6975.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/策略模式.html-3e7ccbc8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/观察者模式.html-1ce60350.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/解释器模式.html-a12c04bf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/访问者模式.html-8abb08b5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/责任链模式.html-aac04461.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/迭代器模式.html-3e4eb5b7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/单例模式.html-db73cadd.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/原型模式.html-460cbe27.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/工厂模式.html-350ff1b7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/建造者模式.html-cb877207.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象工厂模式.html-4ae2d885.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/享元模式.html-e45e53dd.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/代理模式.html-8e1b3a0e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/外观模式.html-a69f5545.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/桥接模式.html-53c942e8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/组合模式.html-d7b5c1c4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/装饰器模式.html-4d7645dc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/适配器模式.html-e84d0f15.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-ed3383e4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker-compose命令大全.html-2a0e4dba.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker常用命令大全.html-d79b09e2.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker镜像构建.html-9df2a948.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-01-Kubernetes系统原理.html-e458650d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-04-Kubectl核心使用.html-9f1e9afa.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-05-Dashboard安装和使用.html-839ddae0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-06-Pod原理和详解.html-3e166721.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-07-工作负载详情.html-918c6c68.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-08-服务介绍.html-4aad69bb.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-09-Ingress.html-8740ccf8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-10-Storage.html-c6314a04.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-11-集群配置默认存储类.html-abf0f6d3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-12-Configmap和Secret.html-3e5046e2.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-13-HorizontalPodAutoscaler.html-7b61da35.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-14-创建并部署WordPress.html-e5acb658.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-15-部署中间件.html-e51d13e7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-16-Devops.html-c98b659c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-17-Istio基本介绍.html-f5e59953.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/字典树.html-2c7285a6.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/常用10种算法.html-17a1c49f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/排序算法.html-95e4dbce.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/AQS工具类.html-77fb2478.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Atomic和Unsafe.html-06dfb1a4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/CPU缓存一致性协议MESI.html-dcabccb4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Collections.html-655c9984.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Executor线程池.html-0b5f0c4a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Future_ForkJoin.html-c27a14af.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java内存模型.html-3f3ce9c0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Synchronized.html-c7bad751.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象队列同步器AQS.html-54b969ae.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/操作系统底层的整体认识.html-7af80a08.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java设计模式.html-4585117b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM内存模型.html-a4e8e02a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM对象创建和内存分配.html-b3baf044.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM类加载机制.html-47e18e2c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器G1和ZGC.html-370e712a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器ParNew和CMS.html-0b2a9e5f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/中介者模式.html-88a3afb3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/命令模式.html-0bace85b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/备忘录模式.html-98b5d718.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/模板模式.html-a1a3122a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/状态模式.html-1d50687c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/策略模式.html-544dd235.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/观察者模式.html-4b21f482.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/解释器模式.html-cdfb208c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/访问者模式.html-2b7948bf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/责任链模式.html-350335a1.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/迭代器模式.html-4f2e1555.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/单例模式.html-4e5f5e21.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/原型模式.html-3a79c02a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/工厂模式.html-817019fa.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/建造者模式.html-76aa3e09.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象工厂模式.html-f519b0c7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/享元模式.html-a461053e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/代理模式.html-7393c115.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/外观模式.html-99ee7d35.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/桥接模式.html-1eaaaca9.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/组合模式.html-d68ec25b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/装饰器模式.html-dba31b7c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/适配器模式.html-a07dfe6c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/404.html-38d245cb.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress-starter/" class=""><!----><span class="site-name">VuePress ！</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/jvm/JVM内存模型.md" class="" aria-label="Jvm"><!--[--><!--]--> Jvm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/arithmetic/字典树.md" class="" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/concurrent/操作系统底层的整体认识.md" class="" aria-label="并发编程"><!--[--><!--]--> 并发编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress-starter/java/design/Java设计模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/build/单例模式.md" class="" aria-label="创建型模式"><!--[--><!--]--> 创建型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/structure/享元模式.md" class="" aria-label="结构型模式"><!--[--><!--]--> 结构型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/action/中介者模式.md" class="" aria-label="行为型模式"><!--[--><!--]--> 行为型模式 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Devops"><span class="title">Devops</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Devops"><span class="title">Devops</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/docker/Docker常用命令大全.md" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes系统原理.md" class="" aria-label="kubernetes"><!--[--><!--]--> kubernetes <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/jvm/JVM内存模型.md" class="" aria-label="Jvm"><!--[--><!--]--> Jvm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/arithmetic/字典树.md" class="" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/concurrent/操作系统底层的整体认识.md" class="" aria-label="并发编程"><!--[--><!--]--> 并发编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress-starter/java/design/Java设计模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/build/单例模式.md" class="" aria-label="创建型模式"><!--[--><!--]--> 创建型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/structure/享元模式.md" class="" aria-label="结构型模式"><!--[--><!--]--> 结构型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/action/中介者模式.md" class="" aria-label="行为型模式"><!--[--><!--]--> 行为型模式 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Devops"><span class="title">Devops</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Devops"><span class="title">Devops</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/docker/Docker常用命令大全.md" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes系统原理.md" class="" aria-label="kubernetes"><!--[--><!--]--> kubernetes <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">kubernetes <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.html" class="sidebar-item" aria-label="kubenertes系统原理"><!--[--><!--]--> kubenertes系统原理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="k8s 集群搭建"><!--[--><!--]--> k8s 集群搭建 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_1-主机准备" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 主机准备"><!--[--><!--]--> 1. 主机准备 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_2-系统初始化" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 系统初始化"><!--[--><!--]--> 2. 系统初始化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_3-docker-的安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Docker 的安装"><!--[--><!--]--> 3. Docker 的安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_4-添加阿里云-yum-源" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 添加阿里云 yum 源"><!--[--><!--]--> 4. 添加阿里云 yum 源 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_5-kubeadm、kubelet、kubectl-的安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. kubeadm、kubelet、kubectl 的安装"><!--[--><!--]--> 5. kubeadm、kubelet、kubectl 的安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_6-在-master-节点中部署集群" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 在 Master 节点中部署集群"><!--[--><!--]--> 6. 在 Master 节点中部署集群 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_1-命令行直接安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.命令行直接安装"><!--[--><!--]--> 1.命令行直接安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_2-配置文件安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 配置文件安装"><!--[--><!--]--> 2. 配置文件安装 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_7-将-node-节点加入集群" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.将 node 节点加入集群"><!--[--><!--]--> 7.将 node 节点加入集群 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_8-部署-cni-网络插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="8. 部署 CNI 网络插件"><!--[--><!--]--> 8. 部署 CNI 网络插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_9-master-node-参与工作负载" class="router-link-active router-link-exact-active sidebar-item" aria-label="9. Master node 参与工作负载"><!--[--><!--]--> 9. Master node 参与工作负载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_10-卸载安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="10. 卸载安装"><!--[--><!--]--> 10. 卸载安装 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-04-Kubectl%E6%A0%B8%E5%BF%83%E4%BD%BF%E7%94%A8.html" class="sidebar-item" aria-label="kubectl"><!--[--><!--]--> kubectl <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-05-Dashboard%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8.html" class="sidebar-item" aria-label="Dashboard"><!--[--><!--]--> Dashboard <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-06-Pod%E5%8E%9F%E7%90%86%E5%92%8C%E8%AF%A6%E8%A7%A3.html" class="sidebar-item" aria-label="Kubernetes Pod"><!--[--><!--]--> Kubernetes Pod <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="k8s 集群搭建"><!--[--><!--]--> k8s 集群搭建 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_1-主机准备" class="router-link-active router-link-exact-active sidebar-item" aria-label="1. 主机准备"><!--[--><!--]--> 1. 主机准备 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_2-系统初始化" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 系统初始化"><!--[--><!--]--> 2. 系统初始化 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_3-docker-的安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="3. Docker 的安装"><!--[--><!--]--> 3. Docker 的安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_4-添加阿里云-yum-源" class="router-link-active router-link-exact-active sidebar-item" aria-label="4. 添加阿里云 yum 源"><!--[--><!--]--> 4. 添加阿里云 yum 源 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_5-kubeadm、kubelet、kubectl-的安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="5. kubeadm、kubelet、kubectl 的安装"><!--[--><!--]--> 5. kubeadm、kubelet、kubectl 的安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_6-在-master-节点中部署集群" class="router-link-active router-link-exact-active sidebar-item" aria-label="6. 在 Master 节点中部署集群"><!--[--><!--]--> 6. 在 Master 节点中部署集群 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_1-命令行直接安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.命令行直接安装"><!--[--><!--]--> 1.命令行直接安装 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_2-配置文件安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="2. 配置文件安装"><!--[--><!--]--> 2. 配置文件安装 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_7-将-node-节点加入集群" class="router-link-active router-link-exact-active sidebar-item" aria-label="7.将 node 节点加入集群"><!--[--><!--]--> 7.将 node 节点加入集群 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_8-部署-cni-网络插件" class="router-link-active router-link-exact-active sidebar-item" aria-label="8. 部署 CNI 网络插件"><!--[--><!--]--> 8. 部署 CNI 网络插件 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_9-master-node-参与工作负载" class="router-link-active router-link-exact-active sidebar-item" aria-label="9. Master node 参与工作负载"><!--[--><!--]--> 9. Master node 参与工作负载 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html#_10-卸载安装" class="router-link-active router-link-exact-active sidebar-item" aria-label="10. 卸载安装"><!--[--><!--]--> 10. 卸载安装 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-07-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD%E8%AF%A6%E6%83%85.html" class="sidebar-item" aria-label="K8s Pod 控制器"><!--[--><!--]--> K8s Pod 控制器 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-08-%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D.html" class="sidebar-item" aria-label="08 服务介绍"><!--[--><!--]--> 08 服务介绍 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-09-Ingress.html" class="sidebar-item" aria-label="09.K8s Ingress and 网络"><!--[--><!--]--> 09.K8s Ingress and 网络 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html" class="sidebar-item" aria-label="10 .K8s 存储"><!--[--><!--]--> 10 .K8s 存储 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-11-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E7%B1%BB.html" class="sidebar-item" aria-label="/devops/kubernetes/k8s-11-集群配置默认存储类.md"><!--[--><!--]--> /devops/kubernetes/k8s-11-集群配置默认存储类.md <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-12-Configmap%E5%92%8CSecret.html" class="sidebar-item" aria-label="Configmap and Secret"><!--[--><!--]--> Configmap and Secret <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-13-HorizontalPodAutoscaler.html" class="sidebar-item" aria-label="应用自动弹性伸缩-HPA"><!--[--><!--]--> 应用自动弹性伸缩-HPA <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-14-%E5%88%9B%E5%BB%BA%E5%B9%B6%E9%83%A8%E7%BD%B2WordPress.html" class="sidebar-item" aria-label="创建并部署 WordPress"><!--[--><!--]--> 创建并部署 WordPress <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-15-%E9%83%A8%E7%BD%B2%E4%B8%AD%E9%97%B4%E4%BB%B6.html" class="sidebar-item" aria-label="部署中间件"><!--[--><!--]--> 部署中间件 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-16-Devops.html" class="sidebar-item" aria-label="Devops"><!--[--><!--]--> Devops <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-17-Istio%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D.html" class="sidebar-item" aria-label="Istio 入门"><!--[--><!--]--> Istio 入门 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="k8s-集群搭建" tabindex="-1"><a class="header-anchor" href="#k8s-集群搭建" aria-hidden="true">#</a> k8s 集群搭建</h1><p>Kubeadm 是 k8s 的部署工具，它提供了 kubeadm init 和 kubeadm join，专用于快速部署 k8s 集群，它能通过两条指令完成一个 Kubenetes 集群的搭建。Kubeadm 部署方式的优点是降低了部署门槛，部署方式快捷且简单；</p><h2 id="_1-主机准备" tabindex="-1"><a class="header-anchor" href="#_1-主机准备" aria-hidden="true">#</a> 1. 主机准备</h2><p>准备三台虚拟机，分别安装 CentOS 系统。一台作为 master 节点，另两台作为 node 节点，且每台虚拟机有自己的专属 IP 地址。</p><p>虚拟机的创建和配置注意以下几点：</p><ul><li>硬件按照上文要求进行配置；</li><li>虚拟机之间可以进行网络互通；</li><li>虚拟机可以访问外网，便于下载镜像；</li><li>安装好 wget 工具 <code>yum install wget</code>；</li><li>禁止 swap 分区。但缺点是屏蔽了诸多细节，遇到问题难以排查是哪里出现了问题。</li></ul><h2 id="_2-系统初始化" tabindex="-1"><a class="header-anchor" href="#_2-系统初始化" aria-hidden="true">#</a> 2. 系统初始化</h2><p>第一步：关闭防火墙</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#临时关闭</span>
systemctl stop firewalld
<span class="token comment">#永久关闭</span>
systemctl disable firewalld

systemctl status firewalld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二步：关闭 selinux</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#永久关闭</span>
<span class="token function">sed</span> <span class="token parameter variable">-i</span> <span class="token string">&#39;/selinux/s/enforcing/disabled/&#39;</span> /etc/selinux/config
<span class="token comment">#临时关闭</span>
setenforce <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第三步：关闭 swap</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#临时关闭</span>
swapoff <span class="token parameter variable">-a</span>
<span class="token comment">#永久关闭</span>
<span class="token function">sed</span> <span class="token parameter variable">-ri</span> <span class="token string">&#39;s/.*swap.*/#&amp;/&#39;</span> /etc/fstab
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第四步：设置主机名称，使用命令 <code>hostnamectl set-hostname 主机名</code>，如下三台主机分别设置为：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#查看当前主机名称</span>
<span class="token function">hostname</span>

hostnamectl set-hostname master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第五步：在<code>master</code>节点中添加 hosts，即节点 IP地址+节点名称</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
192.168.146.129 k8s-master
192.168.146.128 k8s-node1
192.168.146.130 k8s-node2
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第六步：将<a href="https://so.csdn.net/so/search?q=%E6%A1%A5%E6%8E%A5&amp;spm=1001.2101.3001.7020" target="_blank" rel="noopener noreferrer">桥接<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>的 IPv4 流量传递到 iptables 的链(所有节点都设置)；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 设置</span>
<span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/sysctl.d/k8s.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
net.ipv4.ip_forward = 1
EOF</span>

<span class="token comment"># 使其生效</span>
<span class="token function">sysctl</span> <span class="token parameter variable">--system</span>
<span class="token comment"># 执行如下命令使修改生效</span>
modprobe br_netfilter
<span class="token function">sysctl</span> <span class="token parameter variable">-p</span> /etc/sysctl.d/k8s.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第七步：时间同步，让各个节点(虚拟机)中的时间与本机时间保持一致。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>yum <span class="token function">install</span> ntpdate <span class="token parameter variable">-y</span>
ntpdate time.windows.com
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-docker-的安装" tabindex="-1"><a class="header-anchor" href="#_3-docker-的安装" aria-hidden="true">#</a> 3. Docker 的安装</h2><p>Kubernetes 默认容器运行时(CRI)为 Docker，所以需要先在各个节点中安装 Docker。</p><p>第一步：yum 包更新到最新。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 更新yum</span>
<span class="token function">sudo</span> yum update
<span class="token comment"># 更新yum软件包索引</span>
yum makecache 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第二步：安装需要的软件包，yum-util*（提供 yum-config-manager 功能）<em>，device-mapper-persistent-data、lvm2</em>（devicemapper 驱动依赖）*；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 安装需要的包</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> <span class="token parameter variable">-y</span> yum-utils device-mapper-persistent-data lvm2
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>第三步：设置 yum 源为阿里云；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 设置阿里云源</span>
<span class="token function">sudo</span> yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>第四步：安装 Docker；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 查看目前官方仓库的docker版本。</span>
yum list docker-ce.x86_64 <span class="token parameter variable">--showduplicates</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span> <span class="token comment">#从高到低列出Docker-ce的版本</span>
<span class="token comment"># 移除docker</span>
yum remove docker-ce docker-ce-clicontainerd.io-y

<span class="token comment"># 安装docker</span>
<span class="token function">sudo</span> yum <span class="token function">install</span> docker-ce
<span class="token comment"># 或</span>
yum <span class="token function">install</span> docker-ce-20.10.8 docker-ce-cli-20.10.8 containerd.io-1.4.10 <span class="token parameter variable">-y</span> <span class="token parameter variable">--allowerasing</span>

<span class="token comment"># 启动 docker</span>
systemctl start <span class="token function">docker</span>
<span class="token comment"># 设置为开机启动</span>
systemctl <span class="token builtin class-name">enable</span> <span class="token function">docker</span> <span class="token parameter variable">--now</span>

<span class="token comment"># 设置Docker镜像加速器修改docker 配置以适应kubelet</span>
<span class="token function">vim</span> /etc/docker/daemon.json 
<span class="token punctuation">{</span>
	<span class="token string">&quot;registry-mirrors&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;https://registry.cn-hangzhou.aliyuncs.com&quot;</span><span class="token punctuation">]</span>,
	<span class="token string">&quot;exec-opts&quot;</span>:<span class="token punctuation">[</span><span class="token string">&quot;native.cgroupdriver=systemd&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token comment"># 重新加载配置</span>
systemctl daemon-reload
systemctl restart <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>第五步：检查 Docker 版本；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 检查 docker 版本</span>
<span class="token function">docker</span> <span class="token parameter variable">-v</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-添加阿里云-yum-源" tabindex="-1"><a class="header-anchor" href="#_4-添加阿里云-yum-源" aria-hidden="true">#</a> 4. 添加阿里云 yum 源</h2><p>此步骤是为了便于今后的下载，在每个节点中执行以下配置；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">cat</span> <span class="token operator">&gt;</span> /etc/yum.repos.d/kubernetes.repo <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
[Kubernetes]
name=kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg   https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
EOF</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-kubeadm、kubelet、kubectl-的安装" tabindex="-1"><a class="header-anchor" href="#_5-kubeadm、kubelet、kubectl-的安装" aria-hidden="true">#</a> 5. kubeadm、kubelet、kubectl 的安装</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>//查看kubeadm版本
yum list kubeadm <span class="token parameter variable">--showduplicates</span> <span class="token operator">|</span><span class="token function">sort</span> <span class="token parameter variable">-r</span>

//移除kubeadm、kubelet、kubectl 
yum remove kubeadm.x86_64 kubectl.x86_64 kubelet.x86_64 <span class="token parameter variable">-y</span>
//安装kubeadm、kubelet、kubectl 
yum <span class="token function">install</span> kubeadm kubectl kubelet-y
//指定版本安装
yum <span class="token function">install</span> kubeadm-1.21.5 kubectl-1.21.5 kubelet-1.21.5 <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>节点对应的位置即可使用 kubectl命令行工具</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl version
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>启动kubelet</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>systemctl daemon-reload
systemctl <span class="token builtin class-name">enable</span> kubelet <span class="token parameter variable">--now</span>
systemctl status kubelet
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-在-master-节点中部署集群" tabindex="-1"><a class="header-anchor" href="#_6-在-master-节点中部署集群" aria-hidden="true">#</a> 6. 在 Master 节点中部署集群</h2><h3 id="_1-命令行直接安装" tabindex="-1"><a class="header-anchor" href="#_1-命令行直接安装" aria-hidden="true">#</a> 1.命令行直接安装</h3><p>在 <code>master</code> 节点中执行以下命令，注意将 master 节点 IP 和 kube 版本号修改为自己主机中所对应的。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubeadm init <span class="token parameter variable">--image</span> <span class="token parameter variable">-repository</span> registry.aliyuncs.com/google_containers --kubernetes-version<span class="token operator">=</span>v1.21.5 --pod-network-cidr<span class="token operator">=</span><span class="token number">10.244</span>.0.0/16 --service-cidr<span class="token operator">=</span><span class="token number">10.20</span>.0.0/16 --apiserver-advertise-address<span class="token operator">=</span><span class="token number">192.168</span>.146.136
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>此步骤执行完成之后，使用命令<code>docker images</code>查看系统中的镜像，可以我们需要的镜像均已安装完成。</p><p>查看提示信息，看到 initialized successfully 说明我们 master 节点上的 k8s 集群已经搭建成功；</p><h3 id="_2-配置文件安装" tabindex="-1"><a class="header-anchor" href="#_2-配置文件安装" aria-hidden="true">#</a> <s>2. 配置文件安</s>装</h3><p>第一步：生成文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubeadm config print init-defaults <span class="token operator">&gt;</span>init-config.yaml
kubeadm init <span class="token parameter variable">--config</span><span class="token operator">=</span>init-config.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>第二部：修改文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">vim</span> init-config.yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_7-将-node-节点加入集群" tabindex="-1"><a class="header-anchor" href="#_7-将-node-节点加入集群" aria-hidden="true">#</a> 7.将 node 节点加入集群</h2><p>查看上一步执行成功后的提示信息，可以看到系统给了我们两条命令；</p><p>① 开启 kubectl 工具的使用(<code>该命令在master节点中执行</code>)。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token environment constant">$HOME</span>/.kube
  <span class="token function">sudo</span> <span class="token function">cp</span> <span class="token parameter variable">-i</span> /etc/kubernetes/admin.conf <span class="token environment constant">$HOME</span>/.kube/config
  <span class="token function">sudo</span> <span class="token function">chown</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-u</span><span class="token variable">)</span></span><span class="token builtin class-name">:</span><span class="token variable"><span class="token variable">$(</span><span class="token function">id</span> <span class="token parameter variable">-g</span><span class="token variable">)</span></span> <span class="token environment constant">$HOME</span>/.kube/config
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Status Checking：</strong></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get cs/node/pod
kubectl get all <span class="token parameter variable">-A</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>② 将 node 节点加入 master 中的集群(<code>该命令在工作节点node中执行</code>)。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubeadm <span class="token function">join</span> <span class="token number">192.168</span>.200.132:6443 <span class="token parameter variable">--token</span> pahgrt.7gn13u88wz4f89an <span class="token punctuation">\</span>
    --discovery-token-ca-cert-hash sha256:7f73daa421d7564a6f813985a03f860350a923967d05cd955f8223d56200eb5b
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>分别在 master 节点中执行第 ① 条命令，在各个 node 节点中执行第 ② 条命令；</p><p>执行完成之后在 master 节点中使用命令 kubectl get nodes 查看此时集群中的工作节点。可以看到，node1 和 node2 工作节点已加入至 master 中的集群。</p><p>③ 在node节点上使用kubectl</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">scp</span> root@k8s-master:/etc/kubernetes/admin.conf /etc/kubernetes/admin.conf

<span class="token builtin class-name">echo</span> <span class="token string">&quot;export KUBECONFIG=/etc/kubernetes/admin.conf&quot;</span> <span class="token operator">&gt;&gt;</span> /etc/profile
<span class="token comment"># 生效</span>
<span class="token builtin class-name">source</span> /etc/profile
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-部署-cni-网络插件" tabindex="-1"><a class="header-anchor" href="#_8-部署-cni-网络插件" aria-hidden="true">#</a> 8. 部署 CNI 网络插件</h2><p>在上述操作完成后，各个工作节点已经加入了集群，但是它们的状态都是 NoReady，这是由于无它们无法跨主机通信的原因。而 CNI 网络插件的主要功能就是实现 pod 资源能够跨宿主机进行通信。在<code>master</code>节点中执行以下命令进行配置：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># /etc/hosts</span>
<span class="token number">185.199</span>.109.133  raw.githubusercontent.com

<span class="token function">wget</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
<span class="token comment"># 如果多个网卡修改增加arg下面的参数</span>
args:
	---ip-masq
	---kube-subnet-mgr
	---iface<span class="token operator">=</span>enp0s8  <span class="token comment">#根据ifconfig -a		</span>

kubectl apply <span class="token parameter variable">-f</span> kube-flannel.yaml
kubectl get ds <span class="token parameter variable">-l</span> <span class="token assign-left variable">app</span><span class="token operator">=</span>flannel <span class="token parameter variable">-n</span> kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Coredns</strong></p><p>在每个节点创建文件/run/flannel/subnet.env写入以下内容。注意每个节点都要加哦，不是主节点</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>FLANNEL_NETWORK=10.244.0.0/16 # 对应kubeadm --pod-network-cidr
FLANNEL_SUBNET=10.244.0.1/24
FLANNEL_MTU=1450
FLANNEL_IPMASQ=true
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><p>然后使用命令 kubectl get pods -n kube-system 查看运行状态，1 代表运行中；</p><p>最后再次使用kubectl get nodes查看集群中的工作节点；可以看到处于开机状态的 master 节点和 node2 节点已经是 ready 状态，处于关闭状态的 node1 节点为 NoReady 状态，测试无误</p><p>Kubernetes 集群搭建完成。</p><h2 id="_9-master-node-参与工作负载" tabindex="-1"><a class="header-anchor" href="#_9-master-node-参与工作负载" aria-hidden="true">#</a> 9. Master node 参与工作负载</h2><p>使用Kubeadm初始化的集群，Pod不会被调度到Master Node上，也就是说Master Node不参与工作负载。这是因为当前的master节点node1被打上了node-role.kubernetes.io/master:NoSchedule的污点：</p><p>查看污点标记:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl describe <span class="token function">node</span> k8s-master <span class="token operator">|</span> <span class="token function">grep</span> Taint 
Taints:node-role.kubernetes.io/master:NoSchedule
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>执行命令去除标记:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 因为这里搭建的是测试环境，去掉这个污点使node1参与工作负载：</span>
kubectl taint nodes k8s-master node-role.kubernetes.io/master-


<span class="token comment"># 设置为一定不能被调度</span>
kubectl taint <span class="token function">node</span> k8s-master03 node-role.kubernetes.io/master<span class="token operator">=</span><span class="token string">&quot;&quot;</span>:NoSchedule
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>kube-proxy开启ipvs:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl describe configmap kube-proxy <span class="token parameter variable">-n</span> kube-system 

<span class="token comment"># 修改ConfigMap的kube-system/kube-proxy中的config.conf，把 mode: &quot;&quot; 改为mode: “ipvs&quot; 保存退出即可</span>
kubectl edit configmap kube-proxy <span class="token parameter variable">-n</span>  kube-system mode: <span class="token string">&quot;ipvs&quot;</span> 

<span class="token comment"># 删除之前的proxy pod</span>
kubectl delete pod *1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看proxy运行状态</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubectl get pod <span class="token parameter variable">-n</span> kube-system <span class="token operator">|</span> <span class="token function">grep</span> kube-proxy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>查看日志,如果有 <code>Using ipvs Proxier.</code> 说明kube-proxy的ipvs 开启成功!</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code> kubectl logs kube-proxy-54qnw <span class="token parameter variable">-n</span> kube-system
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="_10-卸载安装" tabindex="-1"><a class="header-anchor" href="#_10-卸载安装" aria-hidden="true">#</a> 10. 卸载安装</h2><p>使用flannel插件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>kubeadm reset

<span class="token function">ifconfig</span> cni0 down <span class="token operator">&amp;&amp;</span> <span class="token function">ip</span> <span class="token function">link</span> delete cni0
<span class="token function">ifconfig</span> flannel.1 down <span class="token operator">&amp;&amp;</span> <span class="token function">ip</span> <span class="token function">link</span> delete flannel.1
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/cni/
rm-rf /etc/kubernetes
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /root/.kube/config
<span class="token function">rm</span> <span class="token parameter variable">-rf</span> /var/lib/etcd
above is necessary, cnI0 address conflict to setup sandbox. 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Join证书过期</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code>kubeadm token create <span class="token punctuation">-</span><span class="token punctuation">-</span>print<span class="token punctuation">-</span>join<span class="token punctuation">-</span>command

然后把master节点的~/.kube/config文件拷贝到当前NODE

node role change
kubectl label nodes k8s<span class="token punctuation">-</span>master node<span class="token punctuation">-</span>role.kubernetes.io/node=
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: huangxiangquan@yintatech.com">huangxiangquan</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.html" class="" aria-label="kubenertes系统原理"><!--[--><!--]--> kubenertes系统原理 <!--[--><!--]--></a></span><span class="next"><a href="/vuepress-starter/devops/kubernetes/k8s-04-Kubectl%E6%A0%B8%E5%BF%83%E4%BD%BF%E7%94%A8.html" class="" aria-label="kubectl"><!--[--><!--]--> kubectl <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/vuepress-starter/assets/app-999de8cb.js" defer></script>
  </body>
</html>
