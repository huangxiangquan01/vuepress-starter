<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.67">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><title>10 .K8s 存储 | VuePress ！</title><meta name="description" content="这是我的第一个 VuePress 站点">
    <link rel="preload" href="/vuepress-starter/assets/style-9631a17f.css" as="style"><link rel="stylesheet" href="/vuepress-starter/assets/style-9631a17f.css">
    <link rel="modulepreload" href="/vuepress-starter/assets/app-999de8cb.js"><link rel="modulepreload" href="/vuepress-starter/assets/k8s-10-Storage.html-c6314a04.js"><link rel="modulepreload" href="/vuepress-starter/assets/k8s-10-Storage.html-6e04cf17.js"><link rel="prefetch" href="/vuepress-starter/assets/index.html-3e48afd3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker-compose命令大全.html-93eb499d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker常用命令大全.html-f3e287e3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker镜像构建.html-7d7e4c30.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-01-Kubernetes系统原理.html-9dccf374.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-03-Kubeadm搭建集群.html-a0f434da.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-04-Kubectl核心使用.html-b7221f79.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-05-Dashboard安装和使用.html-b4ef007e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-06-Pod原理和详解.html-af85acb7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-07-工作负载详情.html-efda3e84.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-08-服务介绍.html-ccd6b91c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-09-Ingress.html-390ccaf5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-11-集群配置默认存储类.html-b26ea5f4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-12-Configmap和Secret.html-90e577e4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-13-HorizontalPodAutoscaler.html-8899a225.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-14-创建并部署WordPress.html-104e8204.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-15-部署中间件.html-47c1520e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-16-Devops.html-2248dbdf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-17-Istio基本介绍.html-adf5b5c0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/字典树.html-e2c6ee6a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/常用10种算法.html-5b8b9a70.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/排序算法.html-701197dc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/AQS工具类.html-bca75b08.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Atomic和Unsafe.html-1c37fa28.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/CPU缓存一致性协议MESI.html-f077c1c5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Collections.html-b8e8c729.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Executor线程池.html-ce612aa5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Future_ForkJoin.html-fa843369.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java内存模型.html-1c30a945.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Synchronized.html-ac25c50f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象队列同步器AQS.html-9d1d4326.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/操作系统底层的整体认识.html-9ac36108.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java设计模式.html-7f13f31c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM内存模型.html-77ac90db.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM对象创建和内存分配.html-4da68e3a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM类加载机制.html-d5eacc9b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器G1和ZGC.html-6331579d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器ParNew和CMS.html-270444fe.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/中介者模式.html-adab21e6.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/命令模式.html-1320181f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/备忘录模式.html-02606526.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/模板模式.html-3e94ee87.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/状态模式.html-a7df6975.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/策略模式.html-3e7ccbc8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/观察者模式.html-1ce60350.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/解释器模式.html-a12c04bf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/访问者模式.html-8abb08b5.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/责任链模式.html-aac04461.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/迭代器模式.html-3e4eb5b7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/单例模式.html-db73cadd.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/原型模式.html-460cbe27.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/工厂模式.html-350ff1b7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/建造者模式.html-cb877207.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象工厂模式.html-4ae2d885.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/享元模式.html-e45e53dd.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/代理模式.html-8e1b3a0e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/外观模式.html-a69f5545.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/桥接模式.html-53c942e8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/组合模式.html-d7b5c1c4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/装饰器模式.html-4d7645dc.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/适配器模式.html-e84d0f15.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/index.html-ed3383e4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker-compose命令大全.html-2a0e4dba.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker常用命令大全.html-d79b09e2.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Docker镜像构建.html-9df2a948.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-01-Kubernetes系统原理.html-e458650d.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-03-Kubeadm搭建集群.html-725522cd.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-04-Kubectl核心使用.html-9f1e9afa.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-05-Dashboard安装和使用.html-839ddae0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-06-Pod原理和详解.html-3e166721.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-07-工作负载详情.html-918c6c68.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-08-服务介绍.html-4aad69bb.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-09-Ingress.html-8740ccf8.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-11-集群配置默认存储类.html-abf0f6d3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-12-Configmap和Secret.html-3e5046e2.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-13-HorizontalPodAutoscaler.html-7b61da35.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-14-创建并部署WordPress.html-e5acb658.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-15-部署中间件.html-e51d13e7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-16-Devops.html-c98b659c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/k8s-17-Istio基本介绍.html-f5e59953.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/字典树.html-2c7285a6.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/常用10种算法.html-17a1c49f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/排序算法.html-95e4dbce.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/AQS工具类.html-77fb2478.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Atomic和Unsafe.html-06dfb1a4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/CPU缓存一致性协议MESI.html-dcabccb4.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Collections.html-655c9984.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Executor线程池.html-0b5f0c4a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Future_ForkJoin.html-c27a14af.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java内存模型.html-3f3ce9c0.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Synchronized.html-c7bad751.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象队列同步器AQS.html-54b969ae.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/操作系统底层的整体认识.html-7af80a08.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/Java设计模式.html-4585117b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM内存模型.html-a4e8e02a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM对象创建和内存分配.html-b3baf044.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/JVM类加载机制.html-47e18e2c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器G1和ZGC.html-370e712a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/垃圾收集器ParNew和CMS.html-0b2a9e5f.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/中介者模式.html-88a3afb3.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/命令模式.html-0bace85b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/备忘录模式.html-98b5d718.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/模板模式.html-a1a3122a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/状态模式.html-1d50687c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/策略模式.html-544dd235.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/观察者模式.html-4b21f482.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/解释器模式.html-cdfb208c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/访问者模式.html-2b7948bf.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/责任链模式.html-350335a1.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/迭代器模式.html-4f2e1555.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/单例模式.html-4e5f5e21.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/原型模式.html-3a79c02a.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/工厂模式.html-817019fa.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/建造者模式.html-76aa3e09.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/抽象工厂模式.html-f519b0c7.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/享元模式.html-a461053e.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/代理模式.html-7393c115.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/外观模式.html-99ee7d35.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/桥接模式.html-1eaaaca9.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/组合模式.html-d68ec25b.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/装饰器模式.html-dba31b7c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/适配器模式.html-a07dfe6c.js" as="script"><link rel="prefetch" href="/vuepress-starter/assets/404.html-38d245cb.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/vuepress-starter/" class=""><!----><span class="site-name">VuePress ！</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/jvm/JVM内存模型.md" class="" aria-label="Jvm"><!--[--><!--]--> Jvm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/arithmetic/字典树.md" class="" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/concurrent/操作系统底层的整体认识.md" class="" aria-label="并发编程"><!--[--><!--]--> 并发编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress-starter/java/design/Java设计模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/build/单例模式.md" class="" aria-label="创建型模式"><!--[--><!--]--> 创建型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/structure/享元模式.md" class="" aria-label="结构型模式"><!--[--><!--]--> 结构型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/action/中介者模式.md" class="" aria-label="行为型模式"><!--[--><!--]--> 行为型模式 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Devops"><span class="title">Devops</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Devops"><span class="title">Devops</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/docker/Docker常用命令大全.md" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes系统原理.md" class="" aria-label="kubernetes"><!--[--><!--]--> kubernetes <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java"><span class="title">Java</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java"><span class="title">Java</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/jvm/JVM内存模型.md" class="" aria-label="Jvm"><!--[--><!--]--> Jvm <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/arithmetic/字典树.md" class="" aria-label="数据结构与算法"><!--[--><!--]--> 数据结构与算法 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/java/concurrent/操作系统底层的整体认识.md" class="" aria-label="并发编程"><!--[--><!--]--> 并发编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><a href="/vuepress-starter/java/design/Java设计模式.md" class="" aria-label="设计模式"><!--[--><!--]--> 设计模式 <!--[--><!--]--></a></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/build/单例模式.md" class="" aria-label="创建型模式"><!--[--><!--]--> 创建型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/structure/享元模式.md" class="" aria-label="结构型模式"><!--[--><!--]--> 结构型模式 <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/vuepress-starter/java/design/action/中介者模式.md" class="" aria-label="行为型模式"><!--[--><!--]--> 行为型模式 <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Devops"><span class="title">Devops</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Devops"><span class="title">Devops</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/docker/Docker常用命令大全.md" class="" aria-label="docker"><!--[--><!--]--> docker <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes系统原理.md" class="" aria-label="kubernetes"><!--[--><!--]--> kubernetes <!--[--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading active">kubernetes <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a href="/vuepress-starter/devops/kubernetes/k8s-01-Kubernetes%E7%B3%BB%E7%BB%9F%E5%8E%9F%E7%90%86.html" class="sidebar-item" aria-label="kubenertes系统原理"><!--[--><!--]--> kubenertes系统原理 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html" class="sidebar-item" aria-label="k8s 集群搭建"><!--[--><!--]--> k8s 集群搭建 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-04-Kubectl%E6%A0%B8%E5%BF%83%E4%BD%BF%E7%94%A8.html" class="sidebar-item" aria-label="kubectl"><!--[--><!--]--> kubectl <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-05-Dashboard%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8.html" class="sidebar-item" aria-label="Dashboard"><!--[--><!--]--> Dashboard <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-06-Pod%E5%8E%9F%E7%90%86%E5%92%8C%E8%AF%A6%E8%A7%A3.html" class="sidebar-item" aria-label="Kubernetes Pod"><!--[--><!--]--> Kubernetes Pod <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-03-Kubeadm%E6%90%AD%E5%BB%BA%E9%9B%86%E7%BE%A4.html" class="sidebar-item" aria-label="k8s 集群搭建"><!--[--><!--]--> k8s 集群搭建 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-07-%E5%B7%A5%E4%BD%9C%E8%B4%9F%E8%BD%BD%E8%AF%A6%E6%83%85.html" class="sidebar-item" aria-label="K8s Pod 控制器"><!--[--><!--]--> K8s Pod 控制器 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-08-%E6%9C%8D%E5%8A%A1%E4%BB%8B%E7%BB%8D.html" class="sidebar-item" aria-label="08 服务介绍"><!--[--><!--]--> 08 服务介绍 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-09-Ingress.html" class="sidebar-item" aria-label="09.K8s Ingress and 网络"><!--[--><!--]--> 09.K8s Ingress and 网络 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html" class="router-link-active router-link-exact-active router-link-active sidebar-item active" aria-label="10 .K8s 存储"><!--[--><!--]--> 10 .K8s 存储 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_1-volume-and-pv-关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.Volume and PV 关系"><!--[--><!--]--> 1.Volume and PV 关系 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#volume-卷" class="router-link-active router-link-exact-active sidebar-item" aria-label="Volume（卷）"><!--[--><!--]--> Volume（卷） <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_2-存储基本组件介绍" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.存储基本组件介绍"><!--[--><!--]--> 2.存储基本组件介绍 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_1-pv-pvc-storageclass" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.PV/PVC/StorageClass"><!--[--><!--]--> 1.PV/PVC/StorageClass <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_2-四个概念的关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.四个概念的关系"><!--[--><!--]--> 2.四个概念的关系 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_3-生命周期" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.生命周期"><!--[--><!--]--> 3.生命周期 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_4-pv-类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.PV 类型"><!--[--><!--]--> 4.PV 类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_5-pv-卷阶段状态" class="router-link-active router-link-exact-active sidebar-item" aria-label="5.PV 卷阶段状态"><!--[--><!--]--> 5.PV 卷阶段状态 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_6-k8s-存储架构图" class="router-link-active router-link-exact-active sidebar-item" aria-label="6.K8s 存储架构图"><!--[--><!--]--> 6.K8s 存储架构图 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_3-驱动-plugin-实现方法" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.驱动 Plugin 实现方法"><!--[--><!--]--> 3.驱动 Plugin 实现方法 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_1-in-tree" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.In Tree"><!--[--><!--]--> 1.In Tree <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_2-out-of-tree-provisioner-flexvolume" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.Out-of-tree Provisioner-FlexVolume"><!--[--><!--]--> 2.Out-of-tree Provisioner-FlexVolume <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_3-out-of-tree-provisioner-csi" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.Out-of-tree Provisioner -CSI"><!--[--><!--]--> 3.Out-of-tree Provisioner -CSI <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_4-nfs-实现-k8s-存储" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.NFS 实现 K8s 存储"><!--[--><!--]--> 4.NFS 实现 K8s 存储 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_1-nfs-服务的建立" class="router-link-active router-link-exact-active sidebar-item" aria-label="1.NFS 服务的建立"><!--[--><!--]--> 1.NFS 服务的建立 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_2-nfs-静态供应" class="router-link-active router-link-exact-active sidebar-item" aria-label="2.NFS 静态供应"><!--[--><!--]--> 2.NFS 静态供应 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_3-nfs-flex-volume-动态供应" class="router-link-active router-link-exact-active sidebar-item" aria-label="3.NFS flex-volume 动态供应"><!--[--><!--]--> 3.NFS flex-volume 动态供应 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/vuepress-starter/devops/kubernetes/k8s-10-Storage.html#_4-nfs-csi-动态供应" class="router-link-active router-link-exact-active sidebar-item" aria-label="4.NFS CSI 动态供应"><!--[--><!--]--> 4.NFS CSI 动态供应 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-11-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E7%B1%BB.html" class="sidebar-item" aria-label="/devops/kubernetes/k8s-11-集群配置默认存储类.md"><!--[--><!--]--> /devops/kubernetes/k8s-11-集群配置默认存储类.md <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-12-Configmap%E5%92%8CSecret.html" class="sidebar-item" aria-label="Configmap and Secret"><!--[--><!--]--> Configmap and Secret <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-13-HorizontalPodAutoscaler.html" class="sidebar-item" aria-label="应用自动弹性伸缩-HPA"><!--[--><!--]--> 应用自动弹性伸缩-HPA <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-14-%E5%88%9B%E5%BB%BA%E5%B9%B6%E9%83%A8%E7%BD%B2WordPress.html" class="sidebar-item" aria-label="创建并部署 WordPress"><!--[--><!--]--> 创建并部署 WordPress <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-15-%E9%83%A8%E7%BD%B2%E4%B8%AD%E9%97%B4%E4%BB%B6.html" class="sidebar-item" aria-label="部署中间件"><!--[--><!--]--> 部署中间件 <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-16-Devops.html" class="sidebar-item" aria-label="Devops"><!--[--><!--]--> Devops <!--[--><!--]--></a><!----></li><li><a href="/vuepress-starter/devops/kubernetes/k8s-17-Istio%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%BB%8D.html" class="sidebar-item" aria-label="Istio 入门"><!--[--><!--]--> Istio 入门 <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="_10-k8s-存储" tabindex="-1"><a class="header-anchor" href="#_10-k8s-存储" aria-hidden="true">#</a> 10 .K8s 存储</h1><h2 id="_1-volume-and-pv-关系" tabindex="-1"><a class="header-anchor" href="#_1-volume-and-pv-关系" aria-hidden="true">#</a> 1.Volume and PV 关系</h2><h3 id="volume-卷" tabindex="-1"><a class="header-anchor" href="#volume-卷" aria-hidden="true">#</a> Volume（卷）</h3><p>属于 Pod 内部共享资源存储，生命周期和 Pod 相同，与 Container 无关，即使 Pod 上的容 器停止或者重启，Volume 不会受到影响，但是如果 Pod 终止，那么这个 Volume 的生命周 期也将结束。</p><p><strong>创建一个包含两个容器的 Pod</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> muti<span class="token punctuation">-</span>container
    <span class="token key atrule">name</span><span class="token punctuation">:</span> muti<span class="token punctuation">-</span>container
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span><span class="token number">1.9</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> muti<span class="token punctuation">-</span>container
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>storage
      <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/usr/share/nginx/html&quot;</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> centos
      <span class="token key atrule">name</span><span class="token punctuation">:</span> centos
      <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> IfNotPresent
      <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;bin/sh&quot;</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;-c&quot;</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i&gt;&gt;/pod-data/index.html&amp;&amp;date&amp;&amp;date&gt;&gt;/poddata/index.html&amp;&amp;sleep 20; done&quot;</span>
      <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>storage
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> <span class="token string">&quot;/pod-data&quot;</span>
      <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> task<span class="token punctuation">-</span>pv<span class="token punctuation">-</span>storage
  <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token key atrule">dnsPolicy</span><span class="token punctuation">:</span> ClusterFirst
  <span class="token key atrule">restartPolicy</span><span class="token punctuation">:</span> Never
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在配置文件中，你可以看到 Pod 有一个共享卷，名为 task-pv-storage。配置文件中的第一个容器运行了一个 nginx 服务器。共享卷的挂载路径是 /usr/share/nginx/html。第二个容器是基于 centos 镜像的，有一个 /pod-data 的挂载路径。第二个容器运行了下面的命令然后终止。<code>echo Hello from the debian container &gt; /pod-data/index.html </code></p><p>注意，第二个容器在 nginx 服务器的根目录下写了 index.html 文件。</p><h2 id="_2-存储基本组件介绍" tabindex="-1"><a class="header-anchor" href="#_2-存储基本组件介绍" aria-hidden="true">#</a> <strong>2.存储基本组件介绍</strong></h2><p>在 k8s 中 对 于 存 储 的 资 源 抽 象 了 两 个 概 念 ， 分 别 是 PersistentVolume(PV) 、PersistentVolumeClaim(PVC)。</p><ul><li><p>PV 是集群中的资源</p></li><li><p>PVC 是对这些资源的请求。</p></li></ul><p>PV 和 PVC 都只是抽象的概念，在 k8s 中是通过插件的方式提供具体的存储实现，目前包含有 NFS、ceph、iSCSI 和云提供商指定的存储系统，</p><h3 id="_1-pv-pvc-storageclass" tabindex="-1"><a class="header-anchor" href="#_1-pv-pvc-storageclass" aria-hidden="true">#</a> <strong>1.PV/PVC/StorageClass</strong></h3><p>管理存储是管理计算的一个明显问题。该 PersistentVolume 子系统为用户和管理员提供了一个 API，用于抽象如何根据消费方式提供存储的详细信息。为此，我们引入了两个新的<strong>API 资源</strong>：PersistentVolume 和 PersistentVolumeClaim</p><ul><li><p>PV ：PersistentVolume（持久化卷），是对底层的共享存储的一种抽象，PV 由管理员进行创建和配置，它和具体的底层的共享存储技术的实现方式有关，比如 Ceph、GlusterFS、NFS 等，都是通过插件机制完成与共享存储的对接。</p></li><li><p>PersistentVolumeClaim（<strong>PVC</strong>）是由<strong>用户进行存储的请求</strong>。 它类似于 pod。 Pod 消耗节点资源，PVC 消耗 PV 资源。Pod 可以请求特定级别的资源（CPU 和内存）。声明可以请求特定的大小和访问模式（例如，可以一次读/写或多次只读）。</p></li><li><p>虽然 PersistentVolumeClaims 允许用户使用抽象存储资源，但是 PersistentVolumes 对于不同的问题，用户通常需要具有不同属性（例如性能）。群集管理员需要能够提供各种PersistentVolumes 不同的方式，而不仅仅是大小和访问模式，而不会让用户了解这些卷的实现方式。对于这些需求，有 <strong>StorageClass 资源。</strong></p></li><li><p>StorageClass 为管理员提供了一种描述他们提供的存储的“类”的方法。不同的类可能映射到服务质量级别，或备份策略，或者由群集管理员确定的任意策略。 Kubernetes 本身对于什么类别代表是不言而喻的。 这个概念有时在其他存储系统中称为“配置文件”。</p></li><li><p>PV 是运维人员来创建的，开发操作 PVC，可是大规模集群中可能会有很多 PV，如果这些 PV 都需要运维手动来处理这也是一件很繁琐的事情，所以就有了动态供给概念，也就是Dynamic Provisioning，动态供给的关键就是 StorageClass，它的作用就是创建 PV 模板。创建 StorageClass 里面需要定义 PV 属性比如存储类型、大小等；另外创建这种 PV 需要用到存储插件。最终效果是，用户提交PVC，里面指定存储类型，如果符合我们定义的StorageClass，则会为其自动创建 PV 并进行绑定。</p></li></ul><p><strong>PVC 和 PV 是一一对应的。</strong></p><ul><li><p>PV 和 PVC 中的 spec 关键字段要匹配，比如存储（storage）大小。</p></li><li><p>PV 和 PVC 中的 storageClassName 字段必须一致。</p></li></ul><h3 id="_2-四个概念的关系" tabindex="-1"><a class="header-anchor" href="#_2-四个概念的关系" aria-hidden="true">#</a> <strong>2.四个概念的关系</strong></h3><p>Kubernetes 中 存 储 中 有 四 个 重 要 的 概 念 ： Volume 、 PersistentVolume （ PV ）、PersistentVolumeClaim（PVC）、StorageClass。掌握了这四个概念，就掌握了 Kubernetes中存储系统的核心。引用一张图来说明这四者之间的关系。</p><h3 id="_3-生命周期" tabindex="-1"><a class="header-anchor" href="#_3-生命周期" aria-hidden="true">#</a> <strong>3.生命周期</strong></h3><p>PV 是群集中的资源。PVC 是对这些资源的请求，并且还充当对资源的检查。PV 和 PVC之间的相互作用遵循以下生命周期：</p><blockquote><p>Provisioning ——-&gt; Binding ——–&gt;Using——&gt;Releasing——&gt;Recycling</p></blockquote><ol><li>供应准备 Provisioning**---通过集群外的存储系统或者云平台来提供存储持久化支持。</li></ol><ul><li><p>静态提供 Static：集群管理员创建多个 PV。 它们携带可供集群用户使用的真实存储的详细信息。 它们存在于 Kubernetes API 中，可用于消费</p></li><li><p>动态提供 Dynamic：当管理员创建的静态 PV 都不匹配用户的 PersistentVolumeClaim 时，集群可能会尝试为 PVC 动态配置卷。 此配置基于 StorageClasses：PVC 必须请求一个类，并且管理员必须已创建并配置该类才能进行动态配置。 要求该类的声明有效地为自己禁用动态配置。</p></li></ul><ol start="2"><li><p><strong>绑定 Binding</strong>---用户创建 pvc 并指定需要的资源和访问模式。在找到可用 pv 之前，pvc 会保持未绑定状态。</p></li><li><p>** 使用 Using**---用户可在 pod 中像 volume 一样使用 pvc。</p></li><li><p><strong>释放 Releasing</strong>---用户删除 pvc 来回收存储资源，pv 将变成“released”状态。由于还保留着之前的数据，这些数据需要根据不同的策略来处理，否则这些存储资源无法被其他 pvc 使用。</p></li><li><p><strong>回收Recycling</strong>---pv可以设置三种回收策略：保留（Retain），回收（Recycle）和删除（Delete）。</p></li></ol><ul><li><p>保留策略：允许人工处理保留的数据。</p></li><li><p>删除策略：将删除 pv 和外部关联的存储资源，需要插件支持。</p></li><li><p>回收策略：将执行清除操作，之后可以被新的 pvc 使用，需要插件支持。</p></li></ul><blockquote><p>注：目前只有 NFS 和 HostPath 类型卷支持回收策略，AWS EBS,GCE PD,Azure Disk 和 Cinder支持删除(Delete)策略。</p></blockquote><h3 id="_4-pv-类型" tabindex="-1"><a class="header-anchor" href="#_4-pv-类型" aria-hidden="true">#</a> <strong>4.PV 类型</strong></h3><table><thead><tr><th><strong>类型</strong></th><th><strong>描述</strong></th></tr></thead><tbody><tr><td>GCEPersistentDisk</td><td></td></tr><tr><td>AWSElasticBlockStore</td><td></td></tr><tr><td>AzureFile</td><td></td></tr><tr><td>AzureDisk</td><td></td></tr><tr><td>FC (Fibre Channel)</td><td></td></tr><tr><td>Flexvolume</td><td></td></tr><tr><td>Flocker</td><td></td></tr><tr><td>NFS</td><td></td></tr><tr><td>iSCSI</td><td></td></tr><tr><td>RBD (Ceph Block Device)</td><td></td></tr><tr><td>CephFS</td><td></td></tr><tr><td>Cinder (OpenStack block storage)</td><td></td></tr><tr><td>Glusterfs</td><td></td></tr><tr><td>GCEPersistentDisk</td><td></td></tr><tr><td>AWSElasticBlockStore</td><td></td></tr><tr><td>AzureFile</td><td></td></tr><tr><td>AzureDisk</td><td></td></tr><tr><td>FC (Fibre Channel)</td><td></td></tr><tr><td>Flexvolume</td><td></td></tr><tr><td>Flocker</td><td></td></tr></tbody></table><h3 id="_5-pv-卷阶段状态" tabindex="-1"><a class="header-anchor" href="#_5-pv-卷阶段状态" aria-hidden="true">#</a> <strong>5.PV 卷阶段状态</strong></h3><ul><li><p>Available – 资源尚未被 claim 使用</p></li><li><p>Bound – 卷已经被绑定到 claim 了</p></li><li><p>Released – claim 被删除，卷处于释放状态，但未被集群回收。</p></li><li><p>Failed – 卷自动回收失败</p></li></ul><h3 id="_6-k8s-存储架构图" tabindex="-1"><a class="header-anchor" href="#_6-k8s-存储架构图" aria-hidden="true">#</a> <strong>6.K8s 存储架构图</strong></h3><h2 id="_3-驱动-plugin-实现方法" tabindex="-1"><a class="header-anchor" href="#_3-驱动-plugin-实现方法" aria-hidden="true">#</a> <strong>3.驱动 Plugin 实现方法</strong></h2><h3 id="_1-in-tree" tabindex="-1"><a class="header-anchor" href="#_1-in-tree" aria-hidden="true">#</a> <strong>1.In Tree</strong></h3><p>Kubernetes 卷插件目前是“in-tree”，意味着它们与核心 kubernetes 二进制文件链接，编译，构建和一起发布。有不利于核心代码的发布,增加了工作量,并且卷插件的权限太高等缺点需要将后端存储的代码逻辑放到 K8S 的代码中运行。逻辑代码可能会引起与 K8S 其他部件之间的相互影响。</p><h3 id="_2-out-of-tree-provisioner-flexvolume" tabindex="-1"><a class="header-anchor" href="#_2-out-of-tree-provisioner-flexvolume" aria-hidden="true">#</a> <strong>2.Out-of-tree Provisioner-FlexVolume</strong></h3><p>现有的 Flex Volume 插件需要访问节点和主机的根文件系统才能部署第三方驱动程序文件,并且对主机的依赖性强.调用一个主机的可执行程序包的方式执行存储卷的挂载使用。解决了 In-Tree 方式的强耦合，不过命令行调用的方式，在主机安全性、部署依赖的容器化、与 K8S 服务之间的相互扩展性等方面存在不足Flexvolume 运行在 host 空间，不能使用 rbac授权机制访问Kubernetes API，导致其功能极大的受限<code>Storage providers support this type and develop Driver</code></p><h3 id="_3-out-of-tree-provisioner-csi" tabindex="-1"><a class="header-anchor" href="#_3-out-of-tree-provisioner-csi" aria-hidden="true">#</a> <strong>3.Out-of-tree Provisioner -CSI</strong></h3><p>容器存储接口（CSI）是由来自各个 CO 的社区成员（包括 Kubernetes，Mesos，Cloud Foundry和 Docker）之间的合作产生的规范。此接口的目标是为 CO 建立标准化机制，以将任意存储系统暴露给其容器化工作负载。CSI 标准使 K8S 和存储提供者之间将彻底解耦，将存储的所有的部件作为容器形式运行在K8S 上。</p><p>CO Container Orchestrer</p><p>Storage providers support this type and develop Driver</p><h2 id="_4-nfs-实现-k8s-存储" tabindex="-1"><a class="header-anchor" href="#_4-nfs-实现-k8s-存储" aria-hidden="true">#</a> <strong>4.NFS 实现 K8s 存储</strong></h2><p>创建一个 NFS 服务器作为 K8s 的存储系统，nfs 默认不支持动态存储，使用了第三方的 NFS 插件 实现 flexvolume and CSI 方式使用存</p><p>储。</p><h3 id="_1-nfs-服务的建立" tabindex="-1"><a class="header-anchor" href="#_1-nfs-服务的建立" aria-hidden="true">#</a> <strong>1.NFS 服务的建立</strong></h3><p><strong>Server</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install nfs-utils rpcbind -y

systemctl enable rpcbind nfs-server
systemctl start rpcbind nfs-server
systemctl status rpcbind nfs-server

mkdir /nfs-server
vi /etc/exports
/nfs-server *(rw,sync,no_root_squash)
exportfs -a

showmount -e own ip add(如不加可能报错，确保防火墙已经关闭）
showmount -e # 默认查看自己共享的服务，前提是要 DNS 能解析自己，不然容易报错
showmount -a # 显示已经与客户端连接上的目录信息
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Client</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>yum install nfs-utils rpcbind -y
systemctl enable rpcbind nfs-server
systemctl start rpcbind nfs-server
systemctl status rpcbind nfs-server
showmount -e 192.168.56.5

mount -t nfs 192.168.56.5 :/nfs-server /home
umount /home
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>可以共享：自己创建的目录不能进行 mount.</p><p>Note: 在每一个节点都需要安装</p></blockquote><h3 id="_2-nfs-静态供应" tabindex="-1"><a class="header-anchor" href="#_2-nfs-静态供应" aria-hidden="true">#</a> <strong>2.NFS 静态供应</strong></h3><p><strong>PV 创建</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolume
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> pv0001
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">capacity</span><span class="token punctuation">:</span>
 	<span class="token key atrule">storage</span><span class="token punctuation">:</span> 5Gi
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ReadWriteMany
  <span class="token key atrule">persistentVolumeReclaimPolicy</span><span class="token punctuation">:</span> Recycle
       
  <span class="token key atrule">nfs</span><span class="token punctuation">:</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> <span class="token string">&quot;/nfs-server&quot;</span>
    <span class="token key atrule">server</span><span class="token punctuation">:</span> 192.168.56.5
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>PVC 创建</strong></p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
 <span class="token key atrule">name</span><span class="token punctuation">:</span> nfs<span class="token punctuation">-</span>pvc
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ReadWriteMany
       
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 1Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>kubectl get pod/pv/pvc
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_3-nfs-flex-volume-动态供应" tabindex="-1"><a class="header-anchor" href="#_3-nfs-flex-volume-动态供应" aria-hidden="true">#</a> <strong>3.NFS flex-volume 动态供应</strong></h3><p><strong>Provisioner installation</strong></p><p><strong>Storage Class creation</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>apiVersion: storage.k8s.io/v1beta1
kind: StorageClass
metadata:
 name: nfs
provisioner: fuseim.pri/ifs
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-nfs-csi-动态供应" tabindex="-1"><a class="header-anchor" href="#_4-nfs-csi-动态供应" aria-hidden="true">#</a> <strong>4.NFS CSI 动态供应</strong></h3><p>NFS CSI Driver 是 K8s 官方提供的 CSI 示例程序，只实现了 CSI 的最简功能Controller 由 CSI Plugin+csi-provisioner+livenessprobe 组成node-server 由 CSI Plugin+liveness-probe+node-driver-registrar 组成</p><p><strong>StorageClass 定义。</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
 name: nfs-csi
provisioner: nfs.csi.k8s.io
parameters:
 server: 192.168.56.5 #修改为自己的 nfs 的服务器地址
 share: /home/nfs-server #修改为 nfs 的目录
reclaimPolicy: Retain # only retain is supported,目前这个回收策略只支持 Retain
volumeBindingMode: Immediate
mountOptions:
 - hard
 - nfsvers=4.1
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>官网连接更新参考</p><p>https://artifacthub.io/packages/helm/keyporttech/csi-driver-nfs/0.1.4</p><p>https://github.com/kubernetes-csi/csi-driver</p><p>nfs/blob/master/deploy/example/README.md</p></blockquote><p><strong>卸载</strong></p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>kubectl delete -f csi-nfs-controller.yaml --ignore-not-found
kubectl delete -f csi-nfs-node.yaml --ignore-not-found
kubectl delete -f csi-nfs-driverinfo.yaml --ignore-not-found
kubectl delete -f rbac-csi.yaml --ignore-not-found
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>https://blog.csdn.net/qq_40722827/article/details/127948651 https://blog.csdn.net/weixin_43313333/article/details/128666197</p></blockquote></div><!--[--><!--]--></div><footer class="page-meta"><!----><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: huangxiangquan@yintatech.com">huangxiangquan</span><!----><!--]--><!--]--></span></div></footer><nav class="page-nav"><p class="inner"><span class="prev"><a href="/vuepress-starter/devops/kubernetes/k8s-09-Ingress.html" class="" aria-label="09.K8s Ingress and 网络"><!--[--><!--]--> 09.K8s Ingress and 网络 <!--[--><!--]--></a></span><span class="next"><a href="/vuepress-starter/devops/kubernetes/k8s-11-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E9%BB%98%E8%AE%A4%E5%AD%98%E5%82%A8%E7%B1%BB.html" class="" aria-label="/devops/kubernetes/k8s-11-集群配置默认存储类.md"><!--[--><!--]--> /devops/kubernetes/k8s-11-集群配置默认存储类.md <!--[--><!--]--></a></span></p></nav><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/vuepress-starter/assets/app-999de8cb.js" defer></script>
  </body>
</html>
